{
  "$schema": "https://railway.app/railway.schema.json",
  "build": {
    "builder": "NIXPACKS"
  },
  "deploy": {
    "startCommand": "node packages/backend/dist/index.js",
    "restartPolicyType": "ON_FAILURE",
    "restartPolicyMaxRetries": 10,
    "preDeployCommand": "cd packages/backend && npx prisma migrate deploy"
  },
  "domains": [
  ],
   "services": {
      "backend": {
           "build": {
              "buildCommand": "cd packages/backend && npm run build",
              "watchPatterns": ["packages/backend/**/*", "prisma/**/*"]
            },
          "deploy": {
            "startCommand": "node packages/backend/dist/index.js",
            "healthcheckPath": "/api/auth/validate-token",
            "healthcheckTimeout": 120,
            "healthcheckInterval": 30,
            "sleepApplication": true,
            "preDeployCommand": "cd packages/backend && npx prisma migrate deploy"
            },
            "env": {
            }
      },
       "customer-frontend": {
            "build": {
              "buildCommand": "cd packages/customer-frontend && npm run build",
               "watchPatterns": ["packages/customer-frontend/**/*"]
            },
            "deploy": {
                "startCommand": "echo 'Static site, no start command needed'",
               "healthcheckPath": "/",
                "healthcheckTimeout": 120,
               "healthcheckInterval": 30
            },
           "env": {
           }
        },
       "admin-frontend": {
           "build": {
            "buildCommand": "cd packages/admin-frontend && npm run build", 
              "watchPatterns": ["packages/admin-frontend/**/*"]
            },
           "deploy": {
                "startCommand": "echo 'Static site, no start command needed'",
                 "healthcheckPath": "/",
                 "healthcheckTimeout": 120,
                 "healthcheckInterval": 30
           },
            "env": {
            }
      }
  }
} 